


<div class="row">
    <div class="col-6 justify-content-end">
        @if(usuario.idUsuario > 0){
            <h1>Editar Usuario</h1>
        }@else{
            <h1>Registar Usuario</h1>
        }
    </div>
</div>
<div class="row justify-content-end" style="padding-bottom: 20px;">
    <div class="col-1">
        <button class="btn btn-danger" style="width: 100px;" routerLink="/Usuario/UsuarioGetAll"><i class="bi bi-arrow-bar-right"></i></button>
    </div>
</div>


<div class="container shadow-lg rounded-5" style="padding:30px; ">
    <div class="row">
        <div class="col">
            <div class="row">
                <div class="col">
                    <form  #f="ngForm" (ngSubmit)="onSubmit(f)" novalidate>
                        <div class="row">
                            <div class="col-3">
                                <h4>Foto</h4>
                                <div class="row mb-5">
                                    @if (imgPreview!=null) {
                                <img src="data:image/jpeg;base64,{{imgPreview}}" width="60"  />
                            }   
                            @else{
                                <img src="Imagenes/DefaultUser.png" width="60"  />
                            }
                                </div>
                                <div class="row">
                                    <input class="form-control" type="file" name="imagen" (change)="inputIMG($event)" />

                                </div>

                            </div>
                            <div class="col-9">
                                <h4>Datos Personales</h4>
                        <div class="row mb-3">
                            <div class="col">
                                <label class="form-label">Nombre</label>
                                <input name="nombre" type="string" [(ngModel)]="usuario.nombre" placeholder="Ingresa nombre" class="form-control"
                                required #nombre="ngModel" pattern="^[a-zA-Z]+$" [ngClass]="{'is-invalid': f.submitted && nombre.invalid}"
                                />
                                <div *ngIf="f.submitted && nombre.errors" class="invalid-feedback">
                                    <div *ngIf="nombre.errors.required">El nombre es requerido</div>
                                    <div *ngIf="nombre.errors.pattern">El nombre solo puede contener letras</div>
                                </div>
                            </div>
                            <div class="col">
                                <label class="form-label">ApellidoPaterno</label>
                                <input  name="apellidoPaterno"type="string" [(ngModel)]="usuario.apellidoPaterno" placeholder="Ingresa apellido" class="form-control"
                                #paterno="ngModel" required pattern="[a-zA-Z]+$" [ngClass]="{'is-invalid': f.submitted && paterno.invalid}"/>
                                <div *ngIf="f.submitted && paterno.errors" class="invalid-feedback">
                                    <div *ngIf="paterno.errors.required">El apellido es requerido</div>
                                    <div *ngIf="paterno.errors.pattern">El apellido solo puede contener letras</div>
                                </div>
                            </div>
                            <div class="col">
                                <label class="form-label">ApellidoMaterno</label>
                                <input name="apellidoMaterno" type="string" [(ngModel)]="usuario.apellidoMaterno" placeholder="Ingresa apellido" class="form-control"
                                #materno="ngModel" required pattern="[a-zA-Z]+$" [ngClass]="{'is-invalid': f.submitted && materno.invalid}"
                                />
                                <div *ngIf="f.submitted && materno.errors" class="invalid-feedback">
                                    <div *ngIf="materno.errors.required">El apllido es requerido</div>
                                    <div *ngIf="materno.errors.pattern">El apellido solo puede contener letras</div>
                                </div>
                            </div>
                            
                        </div>
                        <div class="row mb-3">
                            <div class="col">
                                <label class="form-label">Rol</label>
                            <select name="rol" class="form-select" [(ngModel)]="selectedRol"
                            #rol="ngModel" required [ngClass]="{'is-invalid': f.submitted && rol.invalid}"
                            >
                             <option  [value]="1">Administrador</option>
                             <option  [value]="2">JefeDirecto</option>
                             <option  [value]="3">Empleado</option>
                             </select>
                             <div *ngIf="f.submitted && rol.errors" class="invalid-feedback">
                                <div *ngIf="rol.errors.required">El rol es requerido"></div>
                             </div>
                            </div>
                            <div class="col">
                                <label class="form-label">Fecha de Nacimiento</label>
                                <!-- <input name="fechaNacimiento" type="date" [(ngModel)]="usuario.fechaNacimiento" class="form-control"/> -->
                                  <input class="form-control" name="fechaNacimiento"
                                  [(ngModel)]="usuario.fechaNacimiento"
                                type="text"
                                mwlFlatpickr
                                [altInput]="true"
                                [altFormat]="'d-m-Y'"
                                [dateFormat]="'d-m-Y'"
                                placeholder="Selecciona una fecha"
                                #fechaNacimiento="ngModel" required [ngClass]="{'is-invalid': f.submitted && fechaNacimiento.invalid}"
                                />
                                <div *ngIf="f.submitted && fechaNacimiento.errors" class="invalid-feedback">
                                    <div *ngIf="fechaNacimiento.errors.required">La fecha de nacimiento es requerida</div>
                                </div>
                            </div>
                           
                            <div class="col">
                                <div class="row">
                                    <label class="form-label">Sexo</label>
                                    <div class="form-check col">
                                        <input class="form-check-input" [(ngModel)]="usuario.sexo"  type="radio" name="flexRadioDefault" id="flexRadioDefault1" value="H">
                                        <label class="form-check-label" for="flexRadioDefault1">Hombre</label>
                                    </div>
                                    <div class="form-check col">
                                        <input class="form-check-input" [(ngModel)]="usuario.sexo"   type="radio" name="flexRadioDefault" id="flexRadioDefault2" value="M" >
                                        <label class="form-check-label" for="flexRadioDefault2">Mujer</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                             <div class="col">
                                <label class="form-label">UserName</label>
                                <input name="userName" type="string" [(ngModel)]="usuario.userName" placeholder="UserName" class="form-control"
                                required #userName="ngModel" pattern="^[a-zA-Z0-9]+$" [ngClass]="{'is-invalid': f.submitted && userName.invalid}"
                                />
                                <div *ngIf="f.submitted && userName.errors" class="invalid-feedback">
                                    <div *ngIf="userName.errors.required">El userName es requerido</div>
                                    <div *ngIf="userName.errors.pattern">El userName solo puede contener letras y numeros</div>
                                </div>
                            </div>
                            <div class="col">
                                <label class="form-label">Email</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-at"></i></span>
                                <input  name="email"type="string" [(ngModel)]="usuario.email" placeholder="email@gmail.com" class="form-control"
                                    required #email="ngModel" pattern="^([a-zA-Z0-9_\.\-\+])+@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$" [ngClass]="{'is-invalid': f.submitted && email.invalid}"
                                />
                                <div *ngIf="f.submitted && email.errors" class="invalid-feedback">
                                    <div *ngIf="email.errors.required">El email es requerido</div>
                                    <div *ngIf="email.errors.pattern">El correo no es valido</div>
                                </div>
                                </div>
                            </div>
                            <div class="col">
                                <label class="form-label">Password</label>
                                <input name="password" type="password" [(ngModel)]="usuario.password" placeholder="Password" class="form-control"
                                required #password="ngModel" [ngClass]="{'is-invalid': f.submitted && password.invalid}"
                                />
                                <div *ngIf="f.submitted && password.errors" class="invalid-feedback">
                                    <div *ngIf="password.errors.required">La contraseña es obligatoria</div>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                             
                            <div class="col">
                                <label class="form-label">Telefono</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-telephone"></i></span>
                                <input  name="telefono"type="string" [(ngModel)]="usuario.telefono" placeholder="5555555555" class="form-control"
                                required #telefono="ngModel" pattern="^[0-9]+$" [ngClass]="{'is-invalid': f.submitted && telefono.invalid}"
                                />
                                </div>
                                <div *ngIf="f.submitted && telefono.errors" class="invalid-feedback">
                                    <div *ngIf="telefono.errors.required">El numero es obligatorio</div>
                                    <div *ngIf="telefono.errors.pattern">Solo se aceptan numeros</div>
                                </div>
                            </div>
                            <div class="col">
                                <label class="form-label">Celular</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-phone"></i></span>
                                    <input name="celular" type="string" [(ngModel)]="usuario.celular" placeholder="5555555555" class="form-control"
                                    pattern="^[0-9]+$" #celular="ngModel" [ngClass]="{'is-invalid': f.submitted && celular.invalid}"
                                    />
                                    <div *ngIf="f.submitted && celular.errors" class="invalid-feedback">
                                        <div *ngIf="celular.errors.pattern">Solo se aceptan numeros</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <label class="form-label">CURP</label>
                                <input name="CURP" type="string" [(ngModel)]="usuario.curp" placeholder="CURP" class="form-control"
                                required #curp="ngModel" pattern="^([A-Z][AEIOUX][A-Z]{2}\d{2}(?:0[1-9]|1[0-2])(?:0[1-9]|[12]\d|3[01])[HM](?:AS|B[CS]|C[CLMSH]|D[FG]|G[TR]|HG|JC|M[CNS]|N[ETL]|OC|PL|Q[TR]|S[PLR]|T[CSL]|VZ|YN|ZS)[B-DF-HJ-NP-TV-Z]{3}[A-Z\d])(\d)$" 
                                [ngClass]="{'is-invalid': f.submitted && curp.invalid}"
                                />
                                <div *ngIf="f.submitted && curp.errors" class="invalid-feedback">
                                    <div *ngIf="curp.errors.required">El CURP es obligatorio</div>
                                    <div *ngIf="curp.errors.pattern">CURP invalido</div>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="row mb-3">
                            <h4>Direccion</h4>
                            <div class="col">
                                 <label class="form-label">Calle</label>
                                <input name="calle" type="string" [(ngModel)]="usuario.direccion!.calle" placeholder="Calle" class="form-control"/>
                            </div>
                            <div class="col">
                                 <label class="form-label">Numero Interior</label>
                                <input name="numeroInterior" type="string" [(ngModel)]="usuario.direccion!.numeroInterior" placeholder="###" class="form-control"
                                pattern="^[0-9]+$" #numeroInterior="ngModel" [ngClass]="{'is-invalid': f.submitted && numeroInterior.invalid}"
                                />
                                <div *ngIf="f.submitted && numeroInterior.errors" class="invalid-feedback">
                                    <div *ngIf="numeroInterior.errors.pattern">Solo se aceptan numeros</div>
                                </div>
                            </div>
                            <div class="col">
                                 <label class="form-label">Numero Exterior</label>
                                <input name="numeroExterior" type="string" [(ngModel)]="usuario.direccion!.numeroExterior" placeholder="###" class="form-control"
                                pattern="^[0-9]+$" #numeroExterior="ngModel" [ngClass]="{'is-invalid': f.submitted && numeroExterior.invalid}"
                                />
                                <div *ngIf="f.submitted && numeroExterior.errors" class="invalid-feedback">
                                    <div *ngIf="numeroExterior.errors.pattern">Solo se aceptan numeros</div>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3" >
                            <div class="col">
                            
                            <label class="form-label">Estado</label>
                            <select name="estado" class="form-select" [(ngModel)]="selectedEstado" (change)="fillMunicipios(selectedEstado)">
                             <option *ngFor="let estado of estados" [value]="estado.idEstado">
                            {{ estado.nombre }}
                            </option>
                             </select>

                            </div>
                            <div class="col">
                            
                            <label class="form-label">Municipio</label>
                            <select name="municipio" class="form-select" [(ngModel)]="selectedMunicipio" (change)="fillColonias(selectedMunicipio)">
                             <option *ngFor="let municipio of municipios" [value]="municipio.idMunicipio">
                            {{ municipio.nombre }}
                            </option>
                             </select>
                            </div>
                            <div class="col">
                            
                            <label class="form-label">Colonia</label>
                            <select name="colonia" class="form-select" [(ngModel)]="selectedColonia">
                             <option *ngFor="let colonia of colonias" [value]="colonia.idColonia">
                            {{ colonia.nombre }}
                            </option>
                            
                             </select>
                            </div>
                        </div>
                            </div>
                        </div>
                        
                        <!-- @if(usuario.imagen!=null){
                                <img src="data:image/jpeg;base64,{{usuario.imagen}}" width="60"  />
                            }@else  -->
                        <!-- Imagen  -->
                         <div class="d-flex justify-content-end gap-2 mt-4">
                        <a class="btn btn-outline-secondary" routerLink="/Usuario/UsuarioGetAll">Cancelar</a>
                        <button type="submit" class="btn btn-primary" >Guardar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>



